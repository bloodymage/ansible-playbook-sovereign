# {{ ansible_managed }}

plugin {
{% if autonomy_dovecot_sieve is defined %}
  sieve = {{ autonomy_dovecot_sieve }}
{% endif %}
{% if autonomy_dovecot_sieve_default is defined %}
  sieve_default = {{ autonomy_dovecot_sieve_default }}
{% endif %}
{% if autonomy_dovecot_sieve_default_name is defined %}
  sieve_default_name = {{ autonomy_dovecot_sieve_default_name }}
{% endif %}
{% if autonomy_dovecot_sieve_global != __autonomy_dovecot_sieve_global %}
  sieve_global = {{ autonomy_dovecot_sieve_global }}
{% endif %}
{% if autonomy_dovecot_sieve_discard is defined %}
  sieve_discard = {{ autonomy_dovecot_sieve_discard }}
{% endif %}
{% for location in autonomy_dovecot_sieve_before %}
  sieve_before{{ loop.index if not loop.first else "" }} = {{ location }}
{% endfor %}
{% for location in autonomy_dovecot_sieve_after %}
  sieve_after{{ loop.index if not loop.first else "" }} = {{ location }}
{% endfor %}
{% if autonomy_dovecot_sieve_extensions is defined %}
  sieve_extensions = {{ autonomy_dovecot_sieve_extensions }}
{% endif %}
{% if autonomy_dovecot_sieve_global_extensions is defined %}
  sieve_global_extensions = {{ autonomy_dovecot_sieve_global_extensions }}
{% endif %}
{% if autonomy_dovecot_sieve_pipe_bin_dir is defined %}
  sieve_pipe_bin_dir = {{ autonomy_dovecot_sieve_pipe_bin_dir }}
{% endif %}
{% if autonomy_dovecot_sieve_plugins is defined %}
  sieve_plugins = {{ autonomy_dovecot_sieve_plugins }}

{% for mailbox in autonomy_dovecot_imapsieve_mailboxes %}
  imapsieve_mailbox{{ loop.index }}_name = {{ mailbox.name }}
  {% if mailbox.from is defined -%}
  imapsieve_mailbox{{ loop.index }}_from = {{ mailbox.from }}
  {% endif -%}
  imapsieve_mailbox{{ loop.index }}_causes = COPY
  imapsieve_mailbox{{ loop.index }}_{{ mailbox.timing }} = file:{{ autonomy_dovecot_sieve_global_dir }}/report-{{ mailbox.type }}.sieve

{% endfor %}
{% endif %}
{% if mail_recipient_delimiter is defined %}
  recipient_delimiter = {{ mail_recipient_delimiter }}
{% endif %}
{% if autonomy_dovecot_sieve_max_script_size is defined %}
  sieve_max_script_size = {{ autonomy_dovecot_sieve_max_script_size }}
{% endif %}
{% if autonomy_dovecot_sieve_max_actions is defined %}
  sieve_max_actions = {{ autonomy_dovecot_sieve_max_actions }}
{% endif %}
{% if autonomy_dovecot_sieve_max_redirects is defined %}
  sieve_max_redirects = {{ autonomy_dovecot_sieve_max_redirects }}
{% endif %}
{% if autonomy_dovecot_sieve_quota_max_scripts is defined %}
  sieve_quota_max_scripts = {{ autonomy_dovecot_sieve_quota_max_scripts }}
{% endif %}
{% if autonomy_dovecot_sieve_quota_max_storage is defined %}
  sieve_quota_max_storage = {{ autonomy_dovecot_sieve_quota_max_storage }}
{% endif %}
{% if autonomy_dovecot_sieve_user_email is defined %}
  sieve_user_email = {{ autonomy_dovecot_sieve_user_email }}
{% endif %}
{% if autonomy_dovecot_sieve_user_log is defined %}
  sieve_user_log = {{ autonomy_dovecot_sieve_user_log }}
{% endif %}
{% if autonomy_dovecot_sieve_redirect_envelope_from is defined %}
  sieve_redirect_envelope_from = {{ autonomy_dovecot_sieve_redirect_envelope_from }}
{% endif %}
{% if autonomy_dovecot_sieve_trace_dir is defined %}
  sieve_trace_dir = {{ autonomy_dovecot_sieve_trace_dir }}
{% endif %}
{% if autonomy_dovecot_sieve_trace_level is defined %}
  sieve_trace_level = {{ autonomy_dovecot_sieve_trace_level }}
{% endif %}
{% if autonomy_dovecot_sieve_trace_debug is defined %}
  sieve_trace_debug = {{ autonomy_dovecot_sieve_trace_debug }}
{% endif %}
{% if autonomy_dovecot_sieve_trace_address is defined %}
  sieve_trace_address = {{ autonomy_dovecot_sieve_trace_address }}
{% endif %}
}
